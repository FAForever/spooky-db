"use strict";!function(){for(var e,t=function(){},i=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=i.length,r=window.console=window.console||{};n--;)r[e=i[n]]||(r[e]=t)}();var unitDb={start:function(e,t){var i=function(e,t){var i=angular.module(e,["ngRoute","ngSanitize","angular-underscore","drahak.hotkeys"]);return i.config(["$routeProvider",function(e){e.when("/",{controller:"homeCtrl",templateUrl:"views/home.html"}).when("/by-class",{controller:"gdiCtrl",templateUrl:"views/by-class.html"}).when("/:ids",{controller:"compareCtrl",templateUrl:"views/compare.html"}).otherwise({templateUrl:"404.html"})}]),i.run(["$rootScope","$location",function(e,t){e.$on("$routeChangeStart",function(){-1<["/","/by-class"].indexOf(t.path())&&t.path()&&localStorage.setItem("lastView",t.path())})}]),i.provider("data",unitDb.services.dataProvider),i.config(["dataProvider",function(e){if(!t)throw"need unit data!";e.setIndex(t)}]),angular.forEach(unitDb.filters,function(e,t){i.filter(t,e)}),angular.forEach(unitDb.directives,function(e,t){i.directive(t,e)}),angular.forEach(unitDb.controllers,function(e,t){i.controller(t,e)}),i.config(["$locationProvider",function(e){e.hashPrefix("")}]),i}(e,t);return angular.bootstrap(document,[e]),i}};(unitDb=unitDb||{}).DpsCalculator={next:null,canCalculate:function(){return!1},_dps:function(){},dps:function(e,t,i){return this.canCalculate(e)?this._dps(e,t,i):this.next&&this.next.dps?this.next.dps(e,t,i):void 0}},unitDb.StubDpsCalculator=angular.extend({},unitDb.DpsCalculator,{canCalculate:function(){return!0},_dps:function(){return-1}}),unitDb.NotNukeDpsCalculator=angular.extend({},unitDb.DpsCalculator,{next:unitDb.StubDpsCalculator,canCalculate:function(e){return!e.NukeWeapon},_dps:function(e,t,i){if(i)return t.shots*e.Damage*t.dotPulse/t.cycle;var n=Math.max(.1*Math.floor(10/e.RateOfFire+.5),.1);n=Math.max((e.RackSalvoChargeTime||0)+(e.RackSalvoReloadTime||0)+(e.MuzzleSalvoDelay||0)*((e.MuzzleSalvoSize||1)-1),n);var r=1;0<(e.MuzzleSalvoDelay||0)?r=e.MuzzleSalvoSize||1:e.RackBones&&0<e.RackBones.length&&(r=e.RackFireTogether?e.RackBones.length*e.RackBones[0].MuzzleBones.length:e.RackBones[0].MuzzleBones.length);var a=e.Damage*(e.DoTPulses||1)+(e.InitialDamage||0);return r*(a=Math.max((Math.floor((e.BeamLifetime||0)/((e.BeamCollisionDelay||0)+.1))+1)*e.Damage,a))*(i&&e.ProjectilesPerOnFire||1)/n}}),unitDb.dpsCalculator=unitDb.NotNukeDpsCalculator,(unitDb=unitDb||{}).UnitDecorator=function(e){function n(e){var t=_.intersection(e.Categories,_.keys(s));return 1===t.length?s[t[0]]:""}function a(e){var t=e.ManualFire?1:0,i=e.RateOfFire,n=1/i,r=e.ProjectilesPerOnFire?e.ProjectilesPerOnFire:1,a=void 0!==e.MuzzleSalvoSize?e.MuzzleSalvoSize:1,o=void 0!==e.MuzzleSalvoDelay?e.MuzzleSalvoDelay:1,l=void 0!==e.DoTPulses?e.DoTPulses:1,c=e.RackBones?e.RackBones.length:1,s=e.Damage*r*l,u={"/projectiles/TIFFragmentationSensorShell01/TIFFragmentationSensorShell01_proj.bp":5,"/projectiles/SIFThunthoArtilleryShell01/SIFThunthoArtilleryShell01_proj.bp":5,"/projectiles/AIFFragmentationSensorShell01/AIFFragmentationSensorShell01_proj.bp":36,"/projectiles/aantorpedocluster01/aantorpedocluster01_proj.bp":2};o=0===o?0:o-.1;var d=Math.pow(10,1);if(n=Math.round((n||0)*d)/d,o=Math.round((o||0)*d)/d,a=Math.round((a||0)*d)/d,0===e.MuzzleSalvoDelay&&(t+=e.RackBones[0].MuzzleBones.length),(void 0!==e.ProjectileId||void 0!==e.ProjectileLifetimeUsesMultiplier)&&void 0===e.ForceSingleFire)if(t=0===o?e.RackBones[0].MuzzleBones.length:a,e.RackFireTogether&&(t*=c),u[e.ProjectileId]&&(t=u[e.ProjectileId]),1!==e.RateOfFire)n="Kamikaze"===e.WeaponCategory?1:n;else if(0!==e.RackSalvoReloadTime){var T=0!==e.RackSalvoChargeTime?Math.floor(e.RackSalvoReloadTime/e.RackSalvoChargeTime):0;n=(e.RackSalvoChargeTime>e.RackSalvoReloadTime?e.RackSalvoChargeTime:T+e.RackSalvoReloadTime)+i+o*t}else n=e.RackSalvoChargeTime+e.RateOfFire;return{shots:t,cycle:n,damage:s,salvoDelay:o,salvoSize:a,dotPulse:l}}function o(e){var t=u[e.Id];if(t)return t;var i=n(e);return("EXP"===i?"T4 ":""===i?"":i+" ")+e.Description}function t(e){var t=o(e),i=0;for(var n in d){i++;var r=d[n].indexOf(t);if(-1<r)return[n,i,r]}return["Unknown",0,0]}var i,r,l,c,s={TECH1:"T1",TECH2:"T2",TECH3:"T3",EXPERIMENTAL:"EXP"},u={XEB0204:"T2 Engineering Station",UEL0401:"Direct Fire Experimental",UAL0401:"Direct Fire Experimental",XSL0401:"Direct Fire Experimental",URL0402:"Direct Fire Experimental",XNL0402:"Direct Fire Experimental",XRL0403:"Direct Fire Experimental",URA0401:"Air Experimental",XRL0401:"Air Experimental",UAA0310:"Air Experimental",XSA0402:"Air Experimental",XNA0401:"Air Experimental",UES0401:"Naval Experimental",UAS0401:"Naval Experimental",UEB2401:"Indirect Fire Experimental",XNL0403:"Indirect Fire Experimental",URL0401:"Indirect Fire Experimental",XSB2401:"Indirect Fire Experimental",XAB2307:"Indirect Fire Experimental",XAB1401:"Other Experimental",XNO0001:"Other Experimental",XEA0002:"Other Experimental",XEB2402:"Other Experimental",XNA0107:"T1 Light Air Transport",XNA0203:"T2 Gunship",UEA0003:"ACU Engineering Drone",UEL0201:"T1 Bot/Tank",URL0107:"T1 Bot/Tank",UAL0201:"T1 Bot/Tank",XSL0201:"T1 Bot/Tank",XNL0201:"T1 Bot/Tank",XSL0101:"T1 Land Scout",XNL0106:"T1 Light Assault Bot",XNL0103:"T1 Mobile Light Artillery",XNL0107:"T1 Tank Destroyer",XSL0202:"T2 Bot",DRL0204:"T2 Bot",DEL0204:"T2 Bot",UEL0203:"T2 Hover Tank",XAL0203:"T2 Hover Tank",XSL0203:"T2 Hover Tank",XNL0203:"T2 Hover Tank",URL0203:"T2 Amphibious Tank",XEL0305:"T3 Main Assault Bot/Tank",XRL0305:"T3 Main Assault Bot/Tank",UAL0303:"T3 Main Assault Bot/Tank",XSL0303:"T3 Main Assault Bot/Tank",XNL0305:"T3 Main Assault Bot/Tank",UEL0303:"T3 Assault Bot",URL0303:"T3 Assault Bot",XNL0303:"T3 Assault Bot",UEL0104:"T1 Mobile Anti-Air",URL0104:"T1 Mobile Anti-Air",UAL0104:"T1 Mobile Anti-Air",XSL0104:"T1 Mobile Anti-Air",XSB2104:"T1 Anti-Air Turret",XNB2202:"T2 Anti-Air Flak Artillery",URL0205:"T2 Mobile Anti-Air",UAL0205:"T2 Mobile Anti-Air",UEL0205:"T2 Mobile Anti-Air",XSL0205:"T2 Mobile Anti-Air",XNL0205:"T2 Mobile Anti-Air",DELK002:"T3 Mobile Anti-Air",DSLK004:"T3 Mobile Anti-Air",DRLK001:"T3 Mobile Anti-Air",DALK003:"T3 Mobile Anti-Air",XNL0302:"T3 Mobile Anti-Air",UAS0102:"T1 Anti-Air Boat",XNS0102:"T2 Torpedo Boat",XRS0204:"T2 Submarine",XAS0204:"T2 Submarine",XNB1102:"T1 Hydrocarbon Power Plant",XNB0304:"T3 Quantum Gateway",XSB5202:"T1 Air Staging Facility",XNB5202:"T1 Air Staging Facility",XNB2207:"T2 Torpedo Launcher",XNO2302:"T3 Heavy Artillery Installation",XAA0305:"T3 Anti-Air Gunship",XSB2304:"T3 Anti-Air SAM Launcher",XSB3104:"T3 Omni Sensor Array",XNB4202:"T2 Shield Generator",URB4207:"T3 Heavy Shield Generator",XNB5101:"T1 Wall Section",XNA0303:"T3 Air Superiority Fighter"},d={"Construction - Buildpower":["T1 Engineer","T2 Engineer","T2 Field Engineer","T3 Engineer","T3 Support Armored Command Unit","Armored Command Unit","ACU Engineering Drone","T1 Engineering Drone","T2 Engineering Station","T3 Engineering Station"],Land:["T1 Bot/Tank","T1 Light Assault Bot","T1 Light Assault Vehicle","T1 Mobile Light Artillery","T1 Tank Destroyer","T1 Mobile Anti-Air","T1 Land Scout","T2 Heavy Tank","T2 Hover Tank","T2 EMP Tank","T2 Amphibious Tank","T2 Bot","T2 Mobile Missile Launcher","T2 Mobile Anti-Air","T2 Mobile Shield Generator","T2 Mobile Stealth Field System","T2 Mobile Bomb","T2 Crab Egg (Flak)","T3 Main Assault Bot/Tank","T3 Assault Bot","T3 Sniper Bot","T3 Mobile Heavy Artillery","T3 Mobile Missile Platform","T3 Mobile Anti-Air","T3 Mobile Shield Generator","T3 Shield Disruptor","T3 Crab Egg (Engineer)","T3 Crab Egg (Brick)","T3 Crab Egg (Artillery)"],Air:["T1 Interceptor","T1 Attack Bomber","T1 Light Gunship","T1 Air Scout","T1 Light Air Transport","T2 Combat Fighter","T2 Fighter/Bomber","T2 Gunship","T2 Torpedo Bomber","T2 Guided Missile","T2 Air Transport","T3 Air Superiority Fighter","T3 Strategic Bomber","T3 Heavy Gunship","T3 Anti-Air Gunship","T3 Torpedo Bomber","T3 Spy Plane","T3 Heavy Air Transport"],Naval:["T1 Attack Submarine","T1 Frigate","T1 Anti-Air Boat","T2 Submarine","T2 Destroyer","T2 Cruiser","T2 Torpedo Boat","T2 Shield Boat","T2 Counter-Intelligence Boat","T3 Submarine Hunter","T3 Battleship","T3 Strategic Missile Submarine","T3 Tactical Submarine","T3 Aircraft Carrier","T3 Battlecruiser","T3 Missile Ship"],Experimental:["Direct Fire Experimental","Air Experimental","Naval Experimental","Indirect Fire Experimental","Other Experimental"],"Structures - Weapons":["T1 Point Defense","T1 Anti-Air Turret","T1 Torpedo Launcher","T2 Point Defense","T2 Anti-Air Flak Artillery","T2 Torpedo Launcher","T2 Artillery Installation","T2 Tactical Missile Launcher","T2 Tactical Missile Defense","T3 Heavy Point Defense","T3 Anti-Air SAM Launcher","T3 Torpedo Ambushing System","T3 Heavy Artillery Installation","T3 Rocket Artillery Installation","T3 Rapid-Fire Artillery Installation","T3 Strategic Missile Launcher","T3 Strategic Missile Defense"],"Structures - Support":["T1 Wall Section","T1 Air Staging Facility","T2 Shield Generator","T2 Shield Generator: ED2","T2 Shield Generator: ED3","T2 Stealth Shield Generator","T3 Shield Generator","T2 Shield Generator: ED4","T2 Shield Generator: ED5","T3 Heavy Shield Generator","T3 Heavy Stealth Shield Generator"],"Structures - Intelligence":["T1 Radar System","T1 Sonar System","T2 Radar System","T2 Sonar System","T2 Stealth Field Generator","T3 Omni Sensor Array","T3 Sonar Platform","T3 Perimeter Monitoring System","T3 Quantum Optics Facility"],"Structures - Economy":["T1 Mass Extractor","T1 Power Generator","T1 Hydrocarbon Power Plant","T1 Energy Storage","T1 Mass Storage","T2 Mass Extractor","T2 Power Generator","T2 Mass Fabricator","T3 Mass Extractor","T3 Power Generator","T3 Mass Fabricator"],"Structures - Factories":["T1 Land Factory","T1 Air Factory","T1 Naval Factory","T2 Land Factory HQ","T2 Land Factory","T2 Air Factory HQ","T2 Air Factory","T2 Naval Factory HQ","T2 Naval Factory","T3 Land Factory HQ","T3 Land Factory","T3 Air Factory HQ","T3 Air Factory","T3 Naval Factory HQ","T3 Naval Factory","T3 Quantum Gateway"]},T={id:e.Id,name:e.General.UnitName,description:e.Description,faction:e.General.FactionName,factionId:{UEF:0,Cybran:1,Aeon:2,Seraphim:3,Nomads:4}[e.General.FactionName],classification:{RULEUC_Engineer:"Build",RULEUC_Commander:"Build",RULEUMT_Amphibious:"Land",RULEUC_MilitaryVehicle:"Land",RULEUC_MilitaryAircraft:"Air",RULEUC_MilitarySub:"Naval",RULEUC_MilitaryShip:"Naval",RULEUC_Weapon:"Base",RULEUC_Sensor:"Base",RULEUC_Factory:"Base",RULEUC_Resource:"Base",RULEUC_MiscSupport:"Base",RULEUC_CounterMeasure:"Base"}[e.General.Classification],gdiClassification:o(e),gdiBaseClassification:(l=e,t(l)[0]),gdiOrder:(i=e,r=t(i),100*r[1]+r[2]),tech:n(e),strategicIcon:e.StrategicIconName,icon:e.General.Icon||"",order:e.BuildIconSortPriority||1e3,fireCycle:function(e){var t=a(e);switch(e.BeamLifetime){case 1:return t.shots+" beam(s) / "+t.cycle+"s, "+9*e.Damage*t.shots+" dmg total";case 0:return"continuous beam: "+e.Damage*t.shots}if(0===t.salvoDelay)return t.shots+" shot"+(1<t.shots?"s":"")+" / "+(1===t.cycle?"":Math.round(10*t.cycle)/10)+" sec<br/>"+e.Damage*t.shots+" total dmg";var i=t.shots,n=Math.pow(10,1),r=Math.round((t.cycle-(i-1)*t.salvoDelay||0)*n)/n;return i+" times 1 projectile / "+t.salvoDelay+" sec + "+r+" sec reload = "+t.cycle+" sec total, "+e.Damage*i+" dmg total"},beamCycle:function(e){if(.1<e.BeamCollisionDelay){var t=Math.round(e.BeamLifetime/(.1+e.BeamCollisionDelay)),i="";return 1<t&&(i="/ "+e.BeamCollisionDelay+"0.1 sec "),t+" times "+e.Damage+" dmg "+i+e.Damage*t+" dmg total"}return 1===e.BeamLifetime?"9 times / 0.1 sec "+e.Damage+" dmg = "+9*e.Damage+" dmg total, 0.8 sec total":e.DoTPulses?e.DoTPulses+" times "+e.Damage+" dmg / "+e.DoTTime/10+" sec = "+e.damage*e.DoTPulses+" total "+(e.DoTTime/10*e.DoTPulses-.1)+" sec total":e.Damage+" dmg"}};T.fullName=((c=T).name?c.name+": ":"")+("EXP"===c.tech?"":c.tech+" ")+c.description;var m,f,p,h,g=["UEL0103","XSL0103","DAA0206","XAA0306"];for(var S in e.Weapon)_.extend(e.Weapon[S],{dps:(f=e.Weapon[S],p=-1<g.indexOf(T.id),void 0,h=a(f),f.ForceSingleFire?null:unitDb.dpsCalculator.dps(f,h,p)),isTML:(m=e.Weapon[S],!!m.ForceSingleFire)});return _.extend(T,e)},unitDb.services={dataProvider:function(){var i=[],n=[],r=null;this.setIndex=function(e){i=e.units,r=e.version},this.$get=["$hotkey","$location",function(e,t){return e.bind("Ctrl + C",function(){t.path("/"+n.join(","))}),{items:_.map(i,function(e){return unitDb.UnitDecorator(e)}),selectedFilterFractions:[],selectedFilterKinds:[],selectedFilterTech:[],contenders:n,version:r}}]}},unitDb.filters={unsafe:["$sce",function(t){return function(e){return t.trustAsHtml(e)}}],if:function(){return function(e,t){if(t)return e}},flatten:function(){return function(e){return angular.isArray(e)?e.join("<br/> "):angular.isObject(e)?_.map(e,function(e,t){if(!angular.isObject(e))return t+(!0===e?"":": "+e)}).join("<br/> "):e}},time:function(){return function(e){return Math.floor(e%3600/60)+":"+("00"+Math.floor(e%3600%60)).slice(-2)}},round:function(){return function(e,t){var i=Math.pow(10,t||0);return Math.round((e||0)*i)/i}},shorten:function(){return function(e){return 1e9-1<e?e/1e9+"G":1e6-1<e?e/1e6+"M":999<e?e/1e3+"k":e}}},unitDb.directives={thumb:[function(){return{restrict:"E",replace:!0,templateUrl:"views/thumb.html"}}],unit:[function(){return{restrict:"E",replace:!0,templateUrl:"views/unit.html",scope:{item:"=content"}}}],filters:[function(){return{restrict:"E",replace:!0,templateUrl:"views/filters.html"}}],appFooter:[function(){return{restrict:"E",replace:!0,templateUrl:"views/app-footer.html"}}]},unitDb.controllers={homeCtrl:["$scope","$window","$location","$hotkey","data",function(r,a,o,e,t){r.factions=[],r.kinds=[],r.tech=[],r.index=t.items,r.version=t.version,r.contenders=t.contenders;function i(e,t){var i=e.indexOf(t);0<=i?e=e.splice(i,1):e.push(t)}function n(e,t){return 0<=e.indexOf(t)}r.toggleFaction=function(e){i(r.factions,e)},r.factionSelected=function(e){return n(r.factions,e)},r.toggleKind=function(e){i(r.kinds,e)},r.kindSelected=function(e){return n(r.kinds,e)},r.toggleTech=function(e){i(r.tech,e)},r.techSelected=function(e){return n(r.tech,e)},r.compare=function(e){e.selected=!e.selected;var t=r.contenders.indexOf(e.id);-1===t?r.contenders.push(e.id):r.contenders.splice(t,1)},r.clear=function(){for(var e in r.index)r.index[e].selected&&(r.index[e].selected=!1);r.contenders.length=0},r.strain=function(e){return(0===r.factions.length||n(r.factions,e.faction))&&(0===r.kinds.length||n(r.kinds,e.classification))&&(0===r.tech.length||n(r.tech,e.tech))};var l=0,c=null;r.unitClick=function(e,t){if(t.ctrlKey)a.open("#/"+e.id,"_blank");else{var i=(new Date).getTime();if(c===e&&i-l<500){e.selected||r.compare(e);var n="/"+r.contenders.join(",");r.$apply(o.path(n))}else c=e,l=i,r.compare(e)}},e.bind("Ctrl + X",r.clear),e.bind("Ctrl + Z",function(){angular.element("#filter").focus()})}],gdiCtrl:["$scope","$window","$location","$hotkey","data",function(r,a,o,e,t){r.compact="true"===localStorage.getItem("compact"),r.factions=t.selectedFilterFractions,r.kinds=t.selectedFilterKinds,r.tech=t.selectedFilterTech,r.index=t.items,r.version=t.version,r.visibleIndex=t.visibleIndex,r.contenders=t.contenders;function i(e,t){var i=e.indexOf(t);0<=i?e=e.splice(i,1):e.push(t)}function n(e,t){return 0<=e.indexOf(t)}r.toggleFaction=function(e){i(r.factions,e)},r.factionSelected=function(e){return n(r.factions,e)},r.toggleKind=function(e){i(r.kinds,e)},r.kindSelected=function(e){return n(r.kinds,e)},r.toggleTech=function(e){i(r.tech,e)},r.techSelected=function(e){return n(r.tech,e)},r.toggleBpSelected=function(e){e.selected=!e.selected;var t=r.contenders.indexOf(e.id);-1===t?r.contenders.push(e.id):r.contenders.splice(t,1)},r.setBpSelected=function(e,t){e.selected=t;var i=r.contenders.indexOf(e.id);-1===i&&t?r.contenders.push(e.id):t||r.contenders.splice(i,1)},r.toggleBpSelectedByGdiClass=function(t){var e=_.sortBy(_.filter(r.index,function(e){return t===e.gdiClassification&&r.strain(e)}),function(e){return e.factionId+e.id.substr(-4)}),i=!0;for(var n in 0<e.length&&(i=!e[0].selected),e)r.setBpSelected(e[n],i)},r.clear=function(){for(var e in r.index)r.index[e].selected&&(r.index[e].selected=!1);r.contenders.splice(r.contenders.len)},r.strain=function(e){return(0===r.factions.length||n(r.factions,e.faction))&&(0===r.kinds.length||n(r.kinds,e.classification))&&(0===r.tech.length||n(r.tech,e.tech))},r.uniqGdiClass=function(e,t){if(0===t||e.gdiClassification!==r.lastDisplayedGdiClassification)return r.lastDisplayedGdiClassification=e.gdiClassification,e.gdiClassification},r.uniqGdiBaseClass=function(e,t){if(0===t||e.gdiBaseClassification!==r.lastDisplayedGdiBaseClassification)return r.lastDisplayedGdiBaseClassification=e.gdiBaseClassification,e.gdiBaseClassification},r.compare=function(e){e.selected=!e.selected;var t=r.contenders.indexOf(e.id);-1===t?r.contenders.push(e.id):r.contenders.splice(t,1)};var l=0,c=null;r.unitClick=function(e,t){if(t.ctrlKey)a.open("#/"+e.id,"_blank");else{var i=(new Date).getTime();if(c===e&&i-l<500){e.selected||r.compare(e);var n="/"+r.contenders.join(",");r.$apply(o.path(n))}else c=e,l=i,r.compare(e)}},r.toggleCompact=function(){r.compact=!r.compact,localStorage.setItem("compact",r.compact)},e.bind("Ctrl + X",r.clear),e.bind("Ctrl + Z",function(){angular.element("#filter").focus()})}],compareCtrl:["$scope","$routeParams","$location","data",function(t,e,i,n){t.layoutClass=localStorage.getItem("compareLayout");var r=e.ids.split(",");t.contenders=_.sortBy(_.filter(n.items,function(e){return _.contains(r,e.id)}),function(e){return r.indexOf(e.id)}),t.layout=function(e){t.layoutClass=e,localStorage.setItem("compareLayout",e)},t.back=function(){var e=localStorage.getItem("lastView")||"/";i.path(e)}}]};